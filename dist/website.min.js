/**
 * whatbrowser.ru, version 0.1.0
 *
 * whatbrowser.ru is freely distributable under the terms of MIT-style license
 * For details, see http://whatbrowser.ru
 */
(function(window,$,UAParser,swfobject,deployJava){"use strict";var navigator=window.navigator;function has_cookies(){if(navigator.cookieEnabled){return true}document.cookie="cookietest=1";var ret=document.cookie.indexOf("cookietest=")!=-1;document.cookie="cookietest=1; expires=Thu, 01-Jan-1970 00:00:01 GMT";return ret}function has_flash(){try{var fo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(fo){return true}}catch(e){if(navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!=undefined&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin){return true}}return false}function load_property(whatbrowser,property_name,load_func,source){whatbrowser[property_name]=source?source[property_name]:load_func()}function browser_size(whatbrowser,source){var self=whatbrowser;load_property(whatbrowser,"browser_size",function(){return{height:$(window).height(),width:$(window).width()}},source);self.browser_size.toString=function(){return self.browser_size.width+" x "+self.browser_size.height+" px"}}function cookies(whatbrowser,source){var self=whatbrowser;load_property(whatbrowser,"cookies",function(){return has_cookies()},source)}function flash(whatbrowser,source){var self=whatbrowser;load_property(whatbrowser,"flash",function(){return{enabled:has_flash(),version:swfobject&&swfobject.getFlashPlayerVersion()}},source);self.flash.toString=function(){if(self.flash.enabled&&self.flash.version){return self.flash.version.major+"."+self.flash.version.minor+"."+self.flash.version.release}else{return self.flash.enabled?"да":"нет"}}}function javafn(whatbrowser,source){var self=whatbrowser;load_property(whatbrowser,"java",function(){return{enabled:navigator.javaEnabled&&navigator.javaEnabled(),version:deployJava&&deployJava.getJREs().shift()}},source);self.java.toString=function(){return self.java.enabled?self.java.version||"да":"нет"}}function language(whatbrowser,source){var self=whatbrowser;load_property(whatbrowser,"language",function(){return navigator.language||navigator.userLanguage},source)}function online(whatbrowser,source){var self=whatbrowser;load_property(whatbrowser,"online",function(){return navigator.onLine},source)}function screenfn(whatbrowser,source){var self=whatbrowser;load_property(whatbrowser,"screen",function(){return window.screen&&{color_depth:window.screen.colorDepth,height:window.screen.height,width:window.screen.width}},source);self.screen.toString=function(){return window.screen?self.screen.width+" x "+self.screen.height+" px, "+self.screen.color_depth+" bit":""}}function ua(whatbrowser,source){var self=whatbrowser;if(!UAParser){self.ua={ua:navigator.userAgent};return}load_property(whatbrowser,"ua",function(){return(new UAParser).getResult()},source);self.ua.toString=function(){return self.ua.ua};self.ua.browser.toString=function(){var browser=self.ua.browser,str=browser.name||"";str+=browser.major&&" "+browser.major||"";str+=browser.version&&" ("+browser.version+")"||"";return str};self.ua.device.toString=function(){var device=self.ua.device,str=device.vendor||"";str+=device.model&&" "+device.model||"";str+=device.type&&" ("+device.type+")"||"";return str};self.ua.engine.toString=function(){var engine=self.ua.engine,str=engine.name||"";str+=engine.version&&" "+engine.version||"";return str};self.ua.os.toString=function(){var os=self.ua.os,str=os.name||"";str+=os.version&&" "+os.version||"";return str}}function fill_geo(whatbrowser,geo){var self=whatbrowser;self.geo=geo;if(self.geo&&self.geo.position){self.geo.position.toString=function(){var position=self.geo.position;return position.latitude?position.latitude+", "+position.longitude:""}}if(self.geo&&self.geo.address){self.geo.address.toString=function(){var address=self.geo.address,str=address.country||"";str+=address.region&&", "+address.region||"";str+=address.city&&", "+address.city||"";return str}}}function geo(whatbrowser){var self=whatbrowser,promise=$.Deferred(),received_answer=false;$.getJSON("//freegeoip.net/json/?callback=?",{timeout:450}).done(function(data){fill_geo(whatbrowser,{ip:data.ip,position:{latitude:data.latitude,longitude:data.longitude},address:{country:data.country_name,region:data.region_name,city:data.city}});console.log("Geo ready");promise.resolve(whatbrowser)}).fail(function(){console.log("Geo failed");promise.resolve(whatbrowser)}).always(function(){received_answer=true});window.setTimeout(function(){if(!received_answer){console.log("Geo failed");promise.resolve(whatbrowser)}},500);return promise}function WhatBrowser(source){var self=this;browser_size(self,source);cookies(self,source);flash(self,source);javafn(self,source);language(self,source);online(self,source);screenfn(self,source);ua(self,source);if(source){fill_geo(self,source.geo)}}WhatBrowser.create=function(options){var whatbrowser=new WhatBrowser,promise=$.Deferred();options=options||{};if(options.geo){geo(whatbrowser).always(function(whatbrowser){promise.resolve(whatbrowser)})}else{promise.resolve(whatbrowser)}return promise};window.WhatBrowser=WhatBrowser;return WhatBrowser})(window,window.jQuery,window.UAParser,window.swfobject,window.deployJava);(function(){"use strict";function hashcode(str){var hash=0,i,chr,len;if(str.length==0)return hash;for(i=0,len=str.length;i<len;i++){chr=str.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0}return hash}function serialize(parent,element){var type,obj=element?parent[element]:parent,serialized="";function quote(el){return'"'+el+'"'}type=typeof obj;if(type==="object"){if(element){serialized+=quote(element)+":{"}else{serialized+="{"}for(var child in obj){serialized+=serialize(obj,child)}serialized+="},"}else if(type==="function"){}else if(type==="string"){serialized+=quote(element)+":"+quote(obj)+","}else{serialized+=quote(element)+":"+obj+","}return serialized}window.Hashcode={serialize:window.JSON?window.JSON.stringify:serialize};return window.Hashcode})();(function($,Cookies,WhatBrowser){"use strict";var PARSE_BASE_URL="https://api.parse.com/1/classes/WhatBrowser",PARSE_HEADERS={"X-Parse-Application-Id":"WxMn71WOwf2RM6s6vYR57Th1rsfRplumcDDaWQxF","X-Parse-REST-API-Key":"EA4xA8UNhbUK5eMyHepEJnUWDyCzoMZxr0t1HOmp"},TIMEOUT=1e3;var parseEnabled=true;function get_id(){function get_id_url(){var hash=window.location.hash;if(hash&&hash.substr(0,2)==="#!"){return{value:hash.substr(2),own:false}}return null}function get_id_cookies(){if(Cookies.enabled){var id=Cookies.get("whatbrowser");if(id){return{value:id,own:true}}}return null}return get_id_url()||get_id_cookies()}function create(){var loader=WhatBrowser.create({geo:true}),promise=$.Deferred();loader.done(function(whatbrowser){if(parseEnabled){$.ajax(PARSE_BASE_URL,{contentType:"application/json",data:JSON.stringify(whatbrowser),dataType:"json",headers:PARSE_HEADERS,timeout:TIMEOUT,type:"POST"}).done(function(response){whatbrowser.id=response.objectId;whatbrowser.link="http://whatbrowser.ru/#!"+whatbrowser.id;if(Cookies.enabled){Cookies.set("whatbrowser",whatbrowser.id,{expires:28800})}promise.resolve(whatbrowser)}).fail(function(xhr,status,error){promise.reject(whatbrowser,error)})}else{promise.reject(whatbrowser,{message:"Parse not initialized"})}});return promise}function load(id){var promise=$.Deferred();if(parseEnabled){$.ajax(PARSE_BASE_URL+"/"+id,{contentType:"application/json",dataType:"json",headers:PARSE_HEADERS,timeout:TIMEOUT,type:"GET"}).done(function(info){var whatbrowser=new WhatBrowser(info);whatbrowser.id=id;whatbrowser.link="http://whatbrowser.ru/#!"+whatbrowser.id;promise.resolve(whatbrowser)}).fail(function(xhr,status,error){promise.reject(error)})}else{promise.reject({message:"Parse not initialized"})}return promise}window.WhatBrowserManager={get_id:get_id,create:create,load:load};return window.WhatBrowserManager})(window.jQuery,window.Cookies,window.WhatBrowser,window.Parse);(function($,ZeroClipboard,Hashcode,WhatBrowser,WhatBrowserManager){"use strict";function render_property(name,value){var str_value=value&&value.toString&&value.toString()||""+value;if(str_value==="undefined"||!str_value){return""}return"<tr>"+"<th>"+name+"</th>"+"<td>"+str_value+"</td>"+"</tr>"}function render_info(whatbrowser){var properties="";properties+=render_property("Куки",whatbrowser.cookies?"да":"нет");properties+=render_property("Флеш",whatbrowser.flash);properties+=render_property("Java",whatbrowser.java);properties+=render_property("Язык",whatbrowser.language);properties+=render_property("Страница",whatbrowser.browser_size);properties+=render_property("Экран",whatbrowser.screen);properties+=render_property("Браузер",whatbrowser.ua&&whatbrowser.ua.browser);properties+=render_property("Движок",whatbrowser.ua&&whatbrowser.ua.engine);properties+=render_property("ОС",whatbrowser.ua&&whatbrowser.ua.os);properties+=render_property("Устройство",whatbrowser.ua&&whatbrowser.ua.device);properties+=render_property("Юзер-агент",whatbrowser.ua);properties+=render_property("IP-адрес",whatbrowser.geo&&whatbrowser.geo.ip);properties+=render_property("Местоположение",whatbrowser.geo&&whatbrowser.geo.address);return properties}function render_header(whatbrowser,own){var header_msg="";if(!own){header_msg="Вы смотрите браузер по ссылке "+'<a href="'+whatbrowser.link+'">'+whatbrowser.id+"</a>"}else if(whatbrowser.ua.browser.name){header_msg="У вас "+whatbrowser.ua.browser.name+" "+whatbrowser.ua.browser.major;header_msg+=whatbrowser.ua.os.name?" на "+whatbrowser.ua.os.name:""}else{header_msg="У вас неизвестный науке браузер :-("}return header_msg}function show_links(whatbrowser){if(ZeroClipboard&&whatbrowser.id&&whatbrowser.flash&&whatbrowser.flash.enabled){$("#copy-value").val(whatbrowser.link)}else if(ZeroClipboard&&whatbrowser.flash&&whatbrowser.flash.enabled){$("#info-link").hide();$("#info-copy").show()}else if(whatbrowser.id){$("#info-link-copy").hide();$("#mail-value").val(whatbrowser.link);$("#info-link-mail").find("a").attr("href","mailto:?subject="+encodeURIComponent("Информация о моем браузере")+"&body="+encodeURIComponent(whatbrowser.link));$("#info-link-mail").show()}else{$("#info-link").hide();$("#info-nothing").show()}}function show_info(whatbrowser,own){var $details=$("#details-table").children("tbody");$details.html(render_info(whatbrowser));$("#details-tocopy").val(Hashcode.serialize(whatbrowser));$("#header-msg").html(render_header(whatbrowser,own));if(own){show_links(whatbrowser)}else{$("#info-link").hide()}$("#message").hide();$("#result").fadeIn()}function init_clipboard($button){var clipboard=new ZeroClipboard($button.get(0));clipboard.on("aftercopy",function(e){var $btn=$(e.target),$text=$btn.prev(),$status=$btn.next();$text.focus().select();$status.text("Скопировано!");window.setTimeout(function(){$status.text("")},500)})}function init_ui(){$(".link-text").click(function(){$(this).select()});ZeroClipboard&&ZeroClipboard.config({hoverClass:"zero-hover",activeClass:"zero-active"});ZeroClipboard&&init_clipboard($("#info-link").find("button"));ZeroClipboard&&init_clipboard($("#info-copy").find("button"))}function show_by_id(id){WhatBrowserManager.load(id.value).done(function(whatbrowser){show_info(whatbrowser,id.own)}).fail(function(error){if(id.own){show()}else{$("#message").find("h2").text("По этой ссылке ничего нет :-(")}})}function show(){WhatBrowserManager.create().done(function(whatbrowser){show_info(whatbrowser,true)}).fail(function(whatbrowser,error){show_info(whatbrowser,true)})}$(function(){init_ui();var id=WhatBrowserManager.get_id();if(id){show_by_id(id)}else{show()}})})(window.jQuery,window.ZeroClipboard,window.Hashcode,window.WhatBrowser,window.WhatBrowserManager);